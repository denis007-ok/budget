var reg24=[
    {
        "region_name": "Белозёрский сельсовет",
        "region_code": "bel",
        "population": "Не участвовал в инициативном бюджетировании",
		"region_sours": "0",
		"region_text": ""
    },
    {
        "region_name": "Булановский сельсовет",
        "region_code": "bul",
        "population": 2241407.21,
		"region_sours": "Ремонт улично-дорожной сети по ул. Таранова, ул. Колхозной от дома № 15 до дома № 24 с. Буланово Октябрьского района Оренбургской области",
		"region_text": "",
        "sum_obl": 1500000.00,
        "sum_m": 741407.21,
        "sum_szm": 371407.21,
        "sum_ip": 370000.00,
        "be": "pic/bul1.jpg",
        "af": "pic/bul2.jpg",
    },
    {
        "region_name": "Васильевский сельсовет",
        "region_code": "vas",
        "population": 1798905,
		"region_sours": "Капитальный ремонт водопровода по ул. Северной села Васильевка Октябрьского района Оренбургской области",
		"region_text": "",
        "sum_obl": 1222898.64,
        "sum_m": 576006.36,
        "sum_szm": 278673.69,
        "sum_ip": 297332.67,
        "be": "pic/vas1.jpeg",
        "af": "pic/vas2.jpeg",
    },
    {
        "region_name": "Ильинский сельсовет",
        "region_code": "il",
        "population": 2032264.04,
        "project_name": "Ремонт дороги",
		"region_sours": "Капитальный ремонт улично-дорожной сети по ул.Центральная, в с.Ильинка Октябрьского района Оренбургской области",
		"region_text": "",
        "sum_obl": 1349999.50,
        "sum_m": 682264.54,
        "sum_szm": 322264.67,
        "sum_ip": 359999.87,
        "be": "pic/il1.jpg",
        "af": "pic/il2.jpg",
    },
    {
        "region_name": "Имангуловский сельсовет",
        "region_code": "im",
        "population": 1392107.33,
		"region_sours": "Благоустройство общественной территории \"Центральный парк\" по ул.Центральная вс.Первое Имангулово, Октябрьского района, Оренбургской области",
		"region_text": "",
        "sum_obl": 973874.67,
        "sum_m": 418232.66,
        "sum_szm": 219482.72,
        "sum_ip": 198749.94,
        "be": "pic/im1.jpg",
        "af": "pic/im2.jpg",
    },
    {
        "region_name": "Комиссаровский сельсовет",
        "region_code": "kom",
        "population": 1321408.51,
		"region_sours": "Капитальный ремонт сетей наружного водоснабжения ул.Центральная с.Комиссарово Октябрьского района Оренбургской области",
		"region_text": "",
        "sum_obl": 929099.66,
        "sum_m": 392308.85,
        "sum_szm": 206308.91,
        "sum_ip": 185999.94,
        "be": "pic/kom1.jpg",
        "af": "pic/kom2.jpg",
    },
    {
        "region_name": "Краснооктябрьский сельсовет",
        "region_code": "kr",
        "population": 980000.00,
		"region_sours": "Устройство детской площадки п.Броды ул. Новая Октябрьского района Оренбургской области",
		"region_text": "",
        "sum_obl": 681595.08,
        "sum_m": 298404.92,
        "sum_szm": 156697.02,
        "sum_ip": 141707.90,
        "be": "pic/kr1.jpg",
        "af": "pic/kr2.jpg",
    },
    {
        "region_name": "Марьевский сельсовет",
        "region_code": "mar",
        "population": "Не участвовал в инициативном бюджетировании",
		"region_sours": "0",
		"region_text": "Сельский совет не учавствовал"
    },
    {
        "region_name": "Нижнегумбетовский сельсовет",
        "region_code": "ng",
        "population": 747542.62,
		"region_sours": "Ограждение кладбища, с. Воскресеновка Октябрьского района, Оренбургской области",
		"region_text": "",
        "sum_obl": 520383.72,
        "sum_m": 227158.9,
        "sum_szm": 117751.36,
        "sum_ip": 109407.54,
        "be": "pic/ng1.jpg",
        "af": "pic/ng2.jpg",
    },
    {
        "region_name": "Новоникитинский сельсовет",
        "region_code": "nov",
        "population": 2062827.35,
		"region_sours": "Ремонт дороги ул. №1 с. Новоникитино, Октябрьский район Оренбургская область",
		"region_text": "",
        "sum_obl": 1423499.54,
        "sum_m": 639327.81,
        "sum_szm": 354627.91,
        "sum_ip": 284699.90,
        "be": "pic/nov1.jpg",
        "af": "pic/nov2.jpg",
    },
    {
        "region_name": "Новотроицкий сельсовет",
        "region_code": "novot",
        "population": 1188796.61,
		"region_sours": "Устройство универсальной спортивной площадки по адресу Оренбургская область, Октябрьский район, с. Новотроицкое",
		"region_text": "",
        "sum_obl": 857638.72,
        "sum_m": 331157.89,
        "sum_szm": 159157.95,
        "sum_ip": 171999.94,
        "be": "pic/novot1.jpg",
        "af": "pic/novot2.jpg",
    },
    {
        "region_name": "Октябрьский сельсовет",
        "region_code": "okt",
        "population": 2316470.00,
		"region_sours": "Ремонт улично-дорожной сети по ул.Нефтяников с.Октябрьское Октябрьского района Оренбургской области",
		"region_text": "",
        "sum_obl": 1500000.00,
        "sum_m": 816470,
        "sum_szm": 506470.00,
        "sum_ip": 310000.00,
        "be": "pic/okt1.jpg",
        "af": "pic/okt2.jpg",
    },
    {
        "region_name": "с.Октябрьское",
        "region_code": "okt2",
        "population": 1545155,
		"region_sours": "0",
		"region_text": ""
    },
    {
        "region_name": "Российский сельсовет",
        "region_code": "ros",
        "population": 1382671.17,
		"region_sours": "Капитальный ремонт водопровода по улицам Центральная, Молодежная, Стадионная в поселке Российский Октябрьского района Оренбургской области",
		"region_text": "",
        "sum_obl": 960993.99,
        "sum_m": 421677.18,
        "sum_szm": 216373.92,
        "sum_ip": 205303.26,
        "be": "pic/ros1.jpg",
        "af": "pic/ros2.jpg",
    },
    {
        "region_name": "Уранбашский сельсовет",
        "region_code": "yr",
        "population": 2019508.38,
		"region_sours": "Ремонт автомобильной дороги по ул.Воскресеновская пос.Уранбаш Октябрьский район Оренбургская область",
		"region_text": "",
        "sum_obl": 1423499.56,
        "sum_m": 596008.82,
        "sum_szm": 358758.89,
        "sum_ip": 237249.93,
        "be": "pic/yr1.jpg",
        "af": "pic/yr2.jpg",
    }
];

var regions = reg24;

$(function func() {

    for(i = 0; i < regions.length; i++) {
        $('#'+ regions[i].region_code)
        .data('region', regions[i]);
        if (regions[i].region_sours != '0') {
        $('#'+ regions[i].region_code)
        .css({'fill':'#0066ff', 'fill-opacity':'0.5'})
    }}

    $('.map g').mouseover(function (e) {
        var region_data=$(this).data('region');
		$('.list-win li[data-link-id=' + region_data.region_code +']').addClass('active');
        $('<div class="info_panel">'+
            region_data.region_name + '<br>' +
            'Сумма: ' + region_data.population.toLocaleString("ru-RU") +
            '</div>'
         )
        .appendTo('body');
        document.querySelector('.be').innerHTML = '<img src="' + region_data.be + '" style="object-fit: contain">';
        document.querySelector('.af').innerHTML = '<img src="' + region_data.af + '" style="object-fit: contain">';
    })
    .mouseleave(function () {
        $('.info_panel').remove();
		$('.list-win li').removeClass('active');
    })
    .mousemove(function(e) {
        var mouseX = e.pageX, //X coordinates of mouse
            mouseY = e.pageY; //Y coordinates of mouse

        $('.info_panel').css({
            top: mouseY-50,
            left: mouseX - ($('.info_panel').width()/2)
        });
    });

	$('.list-win li').mouseover(function (e) {
		var id = $(this).data().linkId;
		$('.imgSvg g[id=' + id +']').addClass('active');
        for(i = 0; i < regions.length; i++) {
            if (regions[i].region_code==id) {
                var region_data=regions[i];
            }   
           };
        document.querySelector('.be').innerHTML = '<img src="' + region_data.be + '" style="object-fit: contain">';
        document.querySelector('.af').innerHTML = '<img src="' + region_data.af + '" style="object-fit: contain">';
	}).mouseleave(function () {
        $('.info_panel').remove();
		$('.imgSvg g').removeClass('active');
    });

	$('.map g').click(function (e) {
        var region_data=$(this).data('region');
        if (region_data.region_sours != '0') {
    $('.overlay').addClass('is-open');
	document.querySelector('.modal-title').innerText = region_data.region_name;
	document.querySelector('.text2').innerText = region_data.region_text;
    document.querySelector('.td1').innerText = region_data.population;
    document.querySelector('.td2').innerText = region_data.sum_obl;
    document.querySelector('.td3').innerText = region_data.sum_szm;
    document.querySelector('.td4').innerText = region_data.sum_ip;
        fmap(region_data);
        document.querySelector('.text1').innerText = region_data.region_sours;
    }
	
    return false;
  });
 
   $('.list-win li').click(function (e) {
	   var id = $(this).data().linkId;
       for(i = 0; i < regions.length; i++) {
		if (regions[i].region_code==id) {
			var region_data=regions[i];
		}   
	   };
       if (region_data.region_sours != "0") {
    $('.overlay').addClass('is-open');
	document.querySelector('.modal-title').innerText = region_data.region_name;
	document.querySelector('.text1').innerText = region_data.region_sours;
	document.querySelector('.text2').innerText = region_data.region_text;
    document.querySelector('.td1').innerText = region_data.population;
    document.querySelector('.td2').innerText = region_data.sum_obl;
    document.querySelector('.td3').innerText = region_data.sum_szm;
    document.querySelector('.td4').innerText = region_data.sum_ip;
    
        fmap(region_data);
        document.querySelector('.text1').innerText = region_data.region_sours;
    };
	
    return false;
  });


});

$(function () {
  $('.close-btn').click(function () {
    $('.overlay').removeClass('is-open');
  });
});

function fmap(region_data) {
    am4core.useTheme(am4themes_animated);
// Themes end

// Create chart instance
var chart = am4core.create("chart-i", am4charts.PieChart);
chart.language.locale = am4lang_ru_RU;
// Let's cut a hole in our Pie chart the size of 40% the radius
chart.innerRadius = am4core.percent(40);



// Add and configure Series
var pieSeries = chart.series.push(new am4charts.PieSeries());
pieSeries.dataFields.value = "value";
pieSeries.dataFields.category = "category";
pieSeries.slices.template.stroke = am4core.color("#fff");
pieSeries.innerRadius = 10;
pieSeries.slices.template.fillOpacity = 0.5;

pieSeries.slices.template.propertyFields.disabled = "labelDisabled";
pieSeries.labels.template.propertyFields.disabled = "labelDisabled";
pieSeries.ticks.template.propertyFields.disabled = "labelDisabled";


// Add data
pieSeries.data = [{
  "category": "Местный бюджет",
  "value": region_data.sum_m
}, {
  "category": "Unused",
  "value": region_data.sum_obl,
  "labelDisabled":true
}];

// Disable sliding out of slices
pieSeries.slices.template.states.getKey("hover").properties.shiftRadius = 0;
pieSeries.slices.template.states.getKey("hover").properties.scale = 1;

// Add second series
var pieSeries2 = chart.series.push(new am4charts.PieSeries());
pieSeries2.dataFields.value = "value";
pieSeries2.dataFields.category = "category";
pieSeries2.slices.template.states.getKey("hover").properties.shiftRadius = 0;
pieSeries2.slices.template.states.getKey("hover").properties.scale = 1;
pieSeries2.slices.template.propertyFields.fill = "fill";

// Add data
pieSeries2.data = [{
  "category": "Средства местного бюджета",
  "value": region_data.sum_szm
}, {
  "category": "Инициативные платежи",
  "value": region_data.sum_ip
}, {
  "category": "Областной бюджет",
  "value": region_data.sum_obl,
  "fill":"#d6642f"
}];


pieSeries.adapter.add("innerRadius", function(innerRadius, target){
  return am4core.percent(40);
})

pieSeries2.adapter.add("innerRadius", function(innerRadius, target){
  return am4core.percent(60);
})

pieSeries.adapter.add("radius", function(innerRadius, target){
  return am4core.percent(100);
})

pieSeries2.adapter.add("radius", function(innerRadius, target){
  return am4core.percent(80);
})
}